process SIPIXELDQM = {

  #=========================================================================================
  # Sources
    # source of simulated hits
    source = PoolSource
    {
      untracked vstring fileNames	    = 
      #{'file:digis.root'}
      #{'file:/afs/cern.ch/user/m/merkelp/scratch0/PhysicsData_511_digis.root'}
      {'rfio:/castor/cern.ch/user/c/chiochia/cmssw/Muon_FullValidation_150pre3.root'}
      #{'rfio:/castor/cern.ch/user/g/genta/Validation/CMSSW_2_1_X_2008-04-17-0200/Muon_FullValidation.root'}
      #{'rfio:/castor/cern.ch/user/c/chiochia/cmssw/QCD_210_FEVTSIM_2008_04_17.root'}
      #{'rfio:/castor/cern.ch/user/c/chiochia/cmssw/mu_pt10_210_PixelOnly.root'}
     untracked uint32  debugVebosity = 1
      untracked bool	debugFlag     = true
    }
    untracked PSet maxEvents = {untracked int32 input = -1}
  # End Sources
  #=========================================================================================

  # MessageLogger service
 	 include "FWCore/MessageLogger/data/MessageLogger.cfi"

  #=========================================================================================
    service = AdaptorConfig {}
  #=========================================================================================
  # Geometry
	# Tracker SimGeometryXML
  	include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
  	# Tracker Geometry Builder
  	include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
  	# Tracker Numbering Builder
  	include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
   	# magn. field
   	include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  # End Geometry
  
  include "CondTools/SiPixel/data/SiPixelCalibConfiguration.cfi"
  replace sipixelcalib_essource.toGet = {
	{
		string record = "SiPixelFedCablingMapRcd"
		#string tag = "SiPixelFedCablingMap_v9"
		string tag = "SiPixelFedCablingMap_v10_mc"
	}
  }
  #=========================================================================================
  # Raw2digi reconstruction:
        include "EventFilter/SiPixelRawToDigi/data/SiPixelRawToDigi.cfi"
        replace siPixelDigis.InputLabel = "source"
        replace siPixelDigis.IncludeErrors = true
	
	
  # SiPixel DQM Modules:
    # SiPixelMonitorRawData
    	include "DQM/SiPixelMonitorRawData/data/SiPixelMonitorRawData.cfi"

    # SiPixelMonitorDigi
    	include "DQM/SiPixelMonitorDigi/data/SiPixelMonitorDigi.cfi"
	
  ################ The Client (SiPixelEDAClient) ################
   module sipixelEDAClient = SiPixelEDAClient {
     untracked int32  CollationtionFlag = 0
     untracked int32  FileSaveFrequency = 50
     untracked int32  StaticUpdateFrequency = 10
     untracked string OutputFilePath = "."     
   }
  # End Modules Configuration
  #=========================================================================================
  
  # DQM services
    include "DQMServices/Core/data/DQM.cfg"    
    replace DQMStore.referenceFileName = "Reference.root"
    
    #module preScaler  = Prescaler{ int32 prescaleFactor = 1 }

  # DQM Online Environment
    # use include file for dqmEnv dqmSaver
    include "DQMServices/Components/data/DQMEnvironment.cfi"
    # Possible conventions are "Online", "Offline" and "RelVal".
    # Default is "Offline"
    replace dqmSaver.convention    = "Online"
    #replace dqmSaver.workflow      = "/A/B/C"
    # replace dqmSaver.dirName       = "."
    # This is the filename prefix
    replace dqmSaver.producer        = "DQM"
    # (this goes into the foldername)
    replace dqmEnv.subSystemFolder   = "Pixel"
    # Ignore run number for MC data
    # replace dqmSaver.forceRunNumber  = -1
    # optionally change fileSaving  conditions
    replace dqmSaver.saveByLumiSection =  -1
    # replace dqmSaver.saveByMinute = -1
    # replace dqmSaver.saveByEvent =  -1
    replace dqmSaver.saveByRun =     1
    replace dqmSaver.saveAtJobEnd = false

  #=========================================================================================

   service = ModuleWebRegistry { }
   service = LockService { untracked vstring labels = { "source" } }

######################## Scheduling
    sequence DIGIreco = {
      siPixelDigis
    }
    sequence RAWmonitor = {
      SiPixelRawDataErrorSource
    }
    sequence DIGImonitor = {
      SiPixelDigiSource
    }
    sequence DQMmodules = {
      dqmEnv,
      dqmSaver
    }
    
  # End Schedule
  #=========================================================================================
  #path p = {DIGIreco,RAWmonitor,DIGImonitor,sipixelEDAClient,DQMmodules}
  #path p = {RAWmonitor,DIGImonitor,sipixelEDAClient,DQMmodules}
  path p = {DIGImonitor,sipixelEDAClient,DQMmodules}

}
