process SIPIXELDQM = {

  #=========================================================================================
  # Sources
    untracked PSet maxEvents = {untracked int32 input = -1}
    // SM Event Source
    source = EventStreamHttpReader
    {
       string sourceURL = "http://cmsdisk1.cms:48500/urn:xdaq-application:service=storagemanager"
        int32 max_event_size = 7000000
        int32 max_queue_depth = 5

        untracked string consumerName = "Pixel DQM Consumer"
        untracked string consumerPriority = "normal"
        untracked int32 headerRetryInterval = 3  // seconds
        untracked double maxEventRequestRate = 2.5  // hertz
        untracked PSet SelectEvents = { vstring SelectEvents={"*"} }
    }

  # End Sources
  #=========================================================================================

  # MessageLogger service
 	 include "FWCore/MessageLogger/data/MessageLogger.cfi"

  #=========================================================================================
    service = AdaptorConfig {}
  #=========================================================================================
  # Geometry
	# Tracker SimGeometryXML
  	include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
  	# include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
  	# include "Geometry/TrackerRecoData/data/trackerRecoGeometryXML.cfi"
  	# include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"

  	# Tracker Geometry Builder
  	include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

  	# Tracker Numbering Builder
  	include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

  	# strip parameter estimator service for SiStripRecHitConverter
  	include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
   
   	# magn. field
   	include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  # End Geometry
  #=========================================================================================

  # Reco Modules:
    # SiPixel Clusterizer
  #	include "RecoLocalTracker/SiPixelClusterizer/data/SiPixelClusterizer.cfi"

    # SiPixelRecHitConverter
   #	include "RecoLocalTracker/SiPixelRecHits/data/SiPixelRecHits.cfi"

    # SiStripClusterizer
  	# include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer_SimData.cfi"
  	# replace SiStripNoiseServiceParameters.UseCalibDataFromDB = false

    # SiStripRecHitConverter
  #	include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
  	##include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
    
    # GlobalMixedSeedGenerator
  #	include "RecoTracker/TkSeedGenerator/data/GlobalMixedSeeds.cff"
  
    # KFTrackCandidateMaker
  #	include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
   
    # CTF analytical track fit
  	# include "RecoTracker/TrackProducer/data/CTFFinalFitAnalytical.cff"
   
    # CTF track fit with material
  #	include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"

    # MonitorTrackGlobal
  #	include "DQM/TrackerMonitorTrack/data/MonitorTrackGlobal.cfi"
  #	replace MonitorTrackGlobal.TrackProducer = "ctfWithMaterialTracks"

    # validation
  #	include "Validation/RecoTrack/data/SiPixelTrackingRecHitsValid.cfi"

    # print out what data is contained in the event where the module is in the path
  #	module EventContentAnalyzer = EventContentAnalyzer {}
  
  #=========================================================================================
  # SiPixel DQM Modules:
    # SiPixelMonitorRawData
    	include "DQM/SiPixelMonitorRawData/data/SiPixelMonitorRawData.cfi"

    # SiPixelMonitorDigi
    	include "DQM/SiPixelMonitorDigi/data/SiPixelMonitorDigi.cfi"

    # SiPixelMonitorCluster
  #  	include "DQM/SiPixelMonitorCluster/data/SiPixelMonitorCluster.cfi"

    # SiPixelMonitorTrack
  #  	include "DQM/SiPixelMonitorTrack/data/SiPixelMonitorTrackResiduals.cfi"

  ################ The Client (SiPixelEDAClient) ################
   module sipixelEDAClient = SiPixelEDAClient {
     untracked int32  CollationtionFlag = 0
     untracked int32  FileSaveFrequency = 50
     untracked int32  StaticUpdateFrequency = 10
     untracked string OutputFilePath = "."     
   }
  # End Modules Configuration
  #=========================================================================================
  
  # DQM services
  	service = DaqMonitorROOTBackEnd{}
	service = DQMShipMonitoring{ untracked uint32 period = 1000 }

    # DQM Online Environment
 #### PUT THIS MODULE INTO YOUR PATH FOR OPERATION AT P5
    module dqmEnv = DQMEventInfo {
	# define folder to store event info (default: EventInfo)
	untracked string eventInfoFolder = "EventInfo"
    }
    
    # DQM Online File saver module
 #### PUT THIS MODULE INTO YOUR PATH FOR OPERATION AT P5
    module dqmSaver = DQMFileSaver {
	# subsystem name (appears in filename)
	# default is: filename is taken from SourceName
	#	      (toplevel of me-dir-tree) fixme
	untracked string fileName = "Pixel"
       # environment flag (default: "Online")
       //# FIXME should be implemented in dbe::save first
	untracked string environment = "Online"
	# Save file every N lumi sections (-1: disabled)
	untracked int32 prescaleLS = -1
	# Save file every N events (-1: disabled)
	untracked int32 prescaleEvt = -1
	# Save file every N minutes (-1: disabled)
	untracked int32 prescaleTime = -1
	# Save at end of run, runnumber in filename (default: true)
	untracked bool saveAtRunEnd = true
	# Save at end of job, no runnumber in filename (default: false)
	untracked bool saveAtJobEnd = false
    }

  #=========================================================================================

  # tracer service - very verbose - useful for debugging only
#  service = Tracer { untracked string indention = "$$"}

   service = ModuleWebRegistry { }

   service = LockService { untracked vstring labels = { "source" } }

######################## Scheduling
    sequence RAWmonitor = {
      SiPixelRawDataErrorSource
    }
    sequence DIGImonitor = {
      SiPixelDigiSource
    }
    sequence CLUmonitor = {
      #siPixelClusters,
      SiPixelClusterSource
    }
    sequence TRKlocalreco = {
      siPixelClusters,
      # siStripClusters,
      siPixelRecHits, 
      siStripMatchedRecHits
    } 
    sequence TRKlocalrec = {
      # siStripClusters,
      siPixelRecHits, 
      siStripMatchedRecHits
    } 
    sequence TRKckf = {
      globalMixedSeeds,
      #ckfTrackCandidates,
      #ctfAnalyticalTracks,
      ctfWithMaterialTracks
    }
    sequence TRKmonitor = {
      MonitorTrackGlobal,
      SiPixelMonitorTrackResiduals
    }
    sequence DQMmodules = {
      dqmEnv,
      dqmSaver
    }
    
  # End Schedule
  #=========================================================================================
  path p = {RAWmonitor,DIGImonitor,sipixelEDAClient,DQMmodules}

}
